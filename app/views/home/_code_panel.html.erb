<script src="/javascripts/codemirror-2.13/lib/codemirror.js"></script>
<link rel="stylesheet" href="/javascripts/codemirror-2.13/lib/codemirror.css">
<script src="/javascripts/codemirror-2.13/mode/javascript/javascript.js"></script>
<link rel="stylesheet" href="/javascripts/codemirror-2.13/theme/default.css">
<link rel="stylesheet" href="/javascripts/codemirror-2.13/theme/night.css">
<link rel="stylesheet" href="/javascripts/codemirror-2.13/theme/elegant.css">
<link rel="stylesheet" href="/javascripts/codemirror-2.13/theme/neat.css">

<script src="/javascripts/sylvester.js"></script>
<script src="/javascripts/jquery.hive.js"></script>
<script src="/javascripts/hfc_runner/hfc_runner.js"></script>
<script src="/javascripts/hfc_code_panel.js"></script>

<style>
	.CodeMirror {
		background-color: #F0F0F0;
	}
</style>


<div id="codeControlPanel" class="controlPanel">
	<div id="codeMainControlPanel">
		Current program: <span id="codeCurrentProgramName" style="font-weight:bold;">Un-named</span> by <span id="codeAuthor"></span>

		<button onclick="codeNew()">
			New
		</button>
		
		<button onclick="codeShowPrograms()">
			Load...
		</button>
		
		<% if User.current_user %>

			<button onclick="codeSave()">
				Save
			</button>
			
			<button onclick="codeSaveAs()">
				Save As...
			</button>
			
			Version <span id="codeVersionNumber" style="font-weight:bold;"></span>:

			<button onclick="codeLoadPreviousVersion()">
				Previous
			</button>

			<button onclick="codeLoadNextVersion()">
				Next
			</button>

			<button onclick="codeLoadLatestVersion()">
				Latest
			</button>

			<button onclick="codeShowGlobals()" style="margin-left:30px;">
				Globals...
			</button>
		<% else %>
		
			<a id="codeLoginToSaveLink" onclick="codeLoginToSave()">Login to save</a>
		
		<% end %>
		

		<span style="float:right; min-width:150px;">
			<span id="codePauseWarning" style="font-weight:bold; display:none; background-color:yellow; color:black;">Paused</span>
			<span id="codeInfiniteLoopWarning" style="font-weight:bold; display:none; background-color:yellow; color:black;">Unresponsive (<a onclick="loadPage('unresponsive')">help</a>)</span>
			<span>Frame rate: </span>
			<span id="codeFps"></span>
			<span id="codeFpsWarning" style="font-weight:bold; display:none; background-color:yellow; color:black;">Frame rate low, try <a href="http://www.google.com/chrome">Chrome</a></span>
		</span>
		
		<% if false %>
			<div id="codeDebugDiv">
				<div class="areaLabel toggleableDiv">
					<span class="expandIcon">+</span> Debug<span class="regularFont"> (trace from debug function)</span>
				</div>
				<div class="thinBorder grayBackground toggleableDivContents" id="debugStream" style="display:none; white-space:nowrap; overflow:auto; width:100%; height:150px;">
				</div>
			</div>

			<div>
				<div class="areaLabel toggleableDiv">
					<span class="expandIcon">+</span> Comments<span class="regularFont" id="programCommentsCount"></span>
					<% if ! @user %>
						<span class="regularFont">Login to post</span>
					<% end %>
				</div>
				<div class="toggleableDivContents" id="programComments" style="display:none;">
				</div>
			</div>
		<% end %>
	</div>

	<div id="codeSaveAsControlPanel" style="display:none;">
		<span class="areaLabel">Save as:</span>
		<input id="codeSaveAsName" type="text" style="width:150px;">
		<button onclick="codeSaveAsOk()">
			Save
		</button>
		<button onclick="codeSaveAsCancel()">
			Cancel
		</button>
	</div>
	
	<div id="codeProgramsControlPanel" style="display:none;">
		<button onclick="codeHidePrograms()">
			Return
		</button>

		<input id="codeFriendAddName" type="text" style="width:150px;"/>
		<button onclick="codeFriendAddByTextField()">
			Add friend
		</button>
	</div>
	
	<div id="codeGlobalsControlPanel" style="display:none;">
		<button onclick="codeHideGlobals()">
			Return
		</button>
		<button onclick="codeNewGlobal()">
			New
		</button>
	</div>
	
</div>

<div id="codeProgramsPanel">
</div>

<div id="codeGlobalsPanel" class="indent10">
</div>

<div id="codeMainPanel" cellpadding="0" cellspacing="5" style="width:100%; overflow-x:hidden; overflow-y:scroll;">

	<div id="codeMainCol1" style="vertical-align:top;">
			
		<div id="codeGlobalCodeDiv" style="display:none;">
			<div style="min-height:20px;">
				<span id="codeMasterErrorState" class="areaLabel" style="background-color:red; color:white;">
				</span>
			</div>
			<div id="codeGlobalControlPanel">
				<span class="areaLabel">
					Global editor
				</span>
				<button onclick="codeSaveGlobal()">Save</button>
				<button onclick="codeCancelGlobal()">Cancel</button>
				<span>
					Version: <span style="font-weight:bold;" id="codeGlobalVersionLabel"></span>
				</span>
				<button onclick="codeGlobalPreviousVersion()">Previous</button>
				<button onclick="codeGlobalNextVersion()">Next</button>
				<button onclick="codeGlobalLatestVersion()">Latest</button>
			</div>
			<textarea id="codeGlobalEditor" class="codeEditor thinBorder" wrap="off" style="white-space:nowrap; overflow:auto; height:100px;"></textarea>
		</div>

		<div id="codeGlobalCodeDivDrag" class="dragBar" style="text-align:center; display:none; height:5px; width:100%; cursor:move;">
			<img src="/images/drag.png"/ style="position:relative; top:3px;">
		</div>

		<div id="codeStartCodeDiv">
			<span class="areaLabel">Start code editor</span>
			<span id="codeStartCodeErrorState" class="areaLabel" style="background-color:red; color:white;"></span>
			<textarea id="codeStartEditor" class="codeEditor thinBorder" wrap="off" style="white-space:nowrap; overflow:auto; height:100px;"></textarea>
		</div>

		<div id="codeStartCodeDivDrag" class="dragBar" style="text-align:center; height:5px; width:100%; cursor:move;">
			<img src="/images/drag.png"/ style="position:relative; top:3px;">
		</div>

		<div id="codeLoopCodeDiv">
			<span class="areaLabel">Loop code editor</span>
			<span id="codeLoopCodeErrorState" class="areaLabel" style="background-color:red; color:white;"></span>
			<textarea id="codeLoopEditor" class="codeEditor thinBorder" wrap="off" style="white-space:nowrap; overflow:auto; height:300px;"></textarea>
		</div>

		<div id="codeLoopCodeDivDrag" class="dragBar" style="text-align:center; display:block; height:5px; width:100%; cursor:move;">
			<img src="/images/drag.png"/ style="position:relative; top:3px;">
		</div>


	</div>

	<div id="codeMainCol2" style="vertical-align:top; height:350px;">
		<div>
			<span class="areaLabel">Canvas</span>
		</div>

		<div id="codeCanvasContainer" style="position:relative;">
			<canvas id="codeMainCanvas0" class="thinBorder" style="background-color:white; position:absolute; left:0; top:0;">
			</canvas>
			<canvas id="codeMainCanvas1" class="thinBorder" style="background-color:white; position:absolute; left:0; top:0;">
			</canvas>
		</div>

		<div id="codeTwiddlersArea" style="padding-top:5px;">
			<div class="areaLabel">
				Twiddlers 
			</div>
			<div class="thinBorder grayBackground">
				<div id="codeCreateATwiddlerNote" style="padding:5px 5px 5px 5px;">
					Create a twiddler by starting a variable name with underscore
				</div>
				<table id="codeTwiddlers">
				</table>
			</div>
		</div>

	</div>

</div>
